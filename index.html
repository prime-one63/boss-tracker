<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Boss Spawn Dashboard</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    body {
      background-color: #f8f9fa;
    }
    .sidebar {
      height: 100vh;
      background-color: #212529;
      color: #fff;
      position: fixed;
      width: 250px;
      top: 0;
      left: 0;
      padding-top: 20px;
    }
    .sidebar h4 {
      text-align: center;
      margin-bottom: 30px;
      font-weight: 600;
    }
    .sidebar a {
      color: #adb5bd;
      display: block;
      padding: 10px 20px;
      text-decoration: none;
      border-radius: 6px;
      transition: background 0.2s, color 0.2s;
    }
    .sidebar a:hover {
      background-color: #495057;
      color: #fff;
    }
    .content {
      margin-left: 250px;
      padding: 30px;
    }
    .boss-card {
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      background: white;
      padding: 20px;
      margin-bottom: 15px;
    }
    .countdown {
      font-size: 1.25rem;
      font-weight: 600;
      color: #0d6efd;
    }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h4>Boss Tracker</h4>
    <a href="#" id="navDashboard" class="active">Dashboard</a>
    <a href="#" id="navBossList">Boss List</a>
  </div>

  <!-- Main Content -->
  <div class="content">
    <!-- Dashboard -->
    <div id="dashboardSection">
      <h3 class="mb-4">Boss Spawn Dashboard</h3>
      <div id="dashboardCards" class="row gy-3"></div>
    </div>

    <!-- Boss List -->
    <div id="bossListSection" style="display:none;">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Boss List Tracker</h3>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#bossModal">+ Add Boss</button>
      </div>

      <div class="card p-3">
        <div class="table-responsive">
          <table id="bossTable" class="table table-hover text-center align-middle">
            <thead class="table-primary">
              <tr>
                <th>Boss</th>
                <th>Hour Spawn</th>
                <th>Last Killed Time</th>
                <th>Next Spawn</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="bossModal" tabindex="-1" aria-labelledby="bossModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="bossForm">
          <div class="modal-header">
            <h5 class="modal-title" id="bossModalLabel">Add Boss Entry</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="editIndex">

            <div class="mb-3">
              <label class="form-label">Boss</label>
              <input type="text" class="form-control" id="bossName" required>
            </div>

            <div class="mb-3">
              <label class="form-label">Hour Spawn (interval)</label>
              <input type="number" class="form-control" id="hourSpawn" min="1" required>
            </div>

            <div class="mb-3">
              <label class="form-label">Last Killed Time</label>
              <input type="datetime-local" class="form-control" id="lastKilledTime" required>
            </div>

            <div class="mb-3">
              <label class="form-label">Next Spawn (auto-calculated)</label>
              <input type="datetime-local" class="form-control" id="nextSpawn" readonly>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    const bossForm = document.getElementById("bossForm");
    const bossTableBody = document.querySelector("#bossTable tbody");
    const bossModal = new bootstrap.Modal(document.getElementById("bossModal"));
    const bossNameInput = document.getElementById("bossName");
    const hourSpawnInput = document.getElementById("hourSpawn");
    const lastKilledTimeInput = document.getElementById("lastKilledTime");
    const nextSpawnInput = document.getElementById("nextSpawn");
    const editIndexInput = document.getElementById("editIndex");

    const dashboardSection = document.getElementById("dashboardSection");
    const bossListSection = document.getElementById("bossListSection");
    const navDashboard = document.getElementById("navDashboard");
    const navBossList = document.getElementById("navBossList");
    const dashboardCards = document.getElementById("dashboardCards");

    let bossData = [];

    // Switch views
    navDashboard.addEventListener("click", () => {
      dashboardSection.style.display = "block";
      bossListSection.style.display = "none";
    });

    navBossList.addEventListener("click", () => {
      dashboardSection.style.display = "none";
      bossListSection.style.display = "block";
    });

    // Auto compute next spawn
    function calculateNextSpawn() {
      const hours = parseFloat(hourSpawnInput.value);
      const lastKilledValue = lastKilledTimeInput.value;
      if (!isNaN(hours) && lastKilledValue) {
        const lastKilled = new Date(lastKilledValue);
        const nextSpawn = new Date(lastKilled.getTime() + hours * 60 * 60 * 1000);
        const localISO = new Date(nextSpawn.getTime() - nextSpawn.getTimezoneOffset() * 60000)
          .toISOString().slice(0, 16);
        nextSpawnInput.value = localISO;
      }
    }

    hourSpawnInput.addEventListener("input", calculateNextSpawn);
    lastKilledTimeInput.addEventListener("input", calculateNextSpawn);

    // Save or edit boss
    bossForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const boss = bossNameInput.value.trim();
      const hourSpawn = parseFloat(hourSpawnInput.value);
      const lastKilled = lastKilledTimeInput.value;
      const nextSpawn = nextSpawnInput.value;
      const editIndex = editIndexInput.value;

      const entry = { boss, hourSpawn, lastKilled, nextSpawn };

      if (editIndex) {
        bossData[editIndex] = entry;
      } else {
        bossData.push(entry);
      }

      renderTable();
      renderDashboard();
      bossForm.reset();
      nextSpawnInput.value = "";
      editIndexInput.value = "";
      bossModal.hide();
    });

    // Render boss list table
    function renderTable() {
      bossTableBody.innerHTML = "";
      bossData.forEach((entry, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${entry.boss}</td>
          <td>${entry.hourSpawn} hr</td>
          <td>${entry.lastKilled}</td>
          <td>${entry.nextSpawn}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="editRow(${index})">Edit</button>
          </td>
        `;
        bossTableBody.appendChild(row);
      });
    }

    // Render dashboard cards
    function renderDashboard() {
      dashboardCards.innerHTML = "";
      bossData.forEach((entry) => {
        const nextSpawnTime = new Date(entry.nextSpawn);
        const card = document.createElement("div");
        card.classList.add("col-md-4");
        card.innerHTML = `
          <div class="boss-card">
            <h5>${entry.boss}</h5>
            <p>Next Spawn: <strong>${nextSpawnTime.toLocaleString()}</strong></p>
            <div class="countdown" id="countdown-${entry.boss.replace(/\s+/g, "")}">--:--:--</div>
          </div>
        `;
        dashboardCards.appendChild(card);
      });
    }

    // Countdown timers
    setInterval(() => {
      bossData.forEach((entry) => {
        const countdownEl = document.getElementById(`countdown-${entry.boss.replace(/\s+/g, "")}`);
        if (countdownEl) {
          const now = new Date();
          const target = new Date(entry.nextSpawn);
          const diff = target - now;
          if (diff > 0) {
            const hrs = Math.floor(diff / (1000 * 60 * 60));
            const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const secs = Math.floor((diff % (1000 * 60)) / 1000);
            countdownEl.textContent = `${hrs.toString().padStart(2, '0')}:${mins
              .toString()
              .padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
          } else {
            countdownEl.textContent = "SPAWNED!";
          }
        }
      });
    }, 1000);

    // Edit entry
    window.editRow = function(index) {
      const entry = bossData[index];
      bossNameInput.value = entry.boss;
      hourSpawnInput.value = entry.hourSpawn;
      lastKilledTimeInput.value = entry.lastKilled;
      nextSpawnInput.value = entry.nextSpawn;
      editIndexInput.value = index;
      document.getElementById("bossModalLabel").textContent = "Edit Boss Entry";
      bossModal.show();
    };
  </script>
</body>
</html>
